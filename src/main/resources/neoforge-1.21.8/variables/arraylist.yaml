defaultvalue: new ArrayList<>()
scopes:
  local:
    init: ArrayList<Object> ${var.getName()} = ${var.getType().getDefaultValue(generator.getWorkspace())};
    get: ${name}
    set: ${name}.addAll(${opt.removeParentheses(value)});
  global_session:
    init: public static ArrayList<Object> ${var.getName()} = ${var.getValue()};
    get: ${JavaModName}Variables.${name}
    set: ${JavaModName}Variables.${name}.addAll(${opt.removeParentheses(value)});
  global_world:
    init: public ArrayList<Object> ${var.getName()} = ${var.getValue()};
    read: |
      ${var.getName()}.clear();
      
      ListTag ${var.getName()}_list = nbt.getListOrEmpty("${var.getName()}");
      for (Tag tag : ${var.getName()}_list) {
        CompoundTag entry = (CompoundTag) tag;
        String type = entry.getStringOr("Type", "");
      
        Object value = switch(type) {
          case "BlockState" -> NbtUtils.readBlockState(lookupProvider.lookupOrThrow(Registries.BLOCK), entry.getCompoundOrEmpty("Value"));
          case "Direction" -> Direction.from3DDataValue(entry.getIntOr("Value", 0));
          case "ItemStack" -> ItemStack.OPTIONAL_CODEC.parse(NbtOps.INSTANCE, nbt.getCompoundOrEmpty("Value")).result().orElse(ItemStack.EMPTY);
          case "Boolean" -> entry.getBooleanOr("Value", false);
          case "Double" -> entry.getDoubleOr("Value", 0.0d);
          case "String" -> entry.getStringOr("Value", "");
          case "Vec3" -> {
            ListTag vecList = entry.getListOrEmpty("Value");
            yield new Vec3(vecList.getDoubleOr(0, 0), vecList.getDoubleOr(1, 0), vecList.getDoubleOr(2, 0));
          }
          case "File" -> new File(entry.getStringOr("Value", ""));
          case "JsonObject" -> com.google.gson.JsonParser.parseString(entry.getStringOr("Value", "")).getAsJsonObject();
          case "JsonArray" -> com.google.gson.JsonParser.parseString(entry.getStringOr("Value", "")).getAsJsonArray();
          default -> entry.getStringOr("Value", "");
        };
      
        ${var.getName()}.add(value);
      }
    write: |
      ListTag ${var.getName()}_list = new ListTag();
      for(int i = 0; i < ${var.getName()}.size(); i++) {
        CompoundTag entry = new CompoundTag();
        entry.putString("Type", ${var.getName()}.get(i).getClass().getSimpleName());
      
        switch (${var.getName()}.get(i)) {
          case BlockState state -> entry.put("Value", NbtUtils.writeBlockState(state));
          case Direction direction -> entry.putInt("Value", direction.get3DDataValue());
          case ItemStack itemStack -> entry.put("Value", (CompoundTag) ItemStack.OPTIONAL_CODEC.encode(itemStack, NbtOps.INSTANCE, new CompoundTag()).result().orElse(new CompoundTag()));
          case Boolean bool -> entry.putBoolean("Value", bool);
          case Double doub -> entry.putDouble("Value", doub);
          case String str -> entry.putString("Value", str);
          case Vec3 vec -> {
            ListTag vecList = new ListTag();
            vecList.add(DoubleTag.valueOf(vec.x));
            vecList.add(DoubleTag.valueOf(vec.y));
            vecList.add(DoubleTag.valueOf(vec.z));
            entry.put("Value", vecList);
          }
          case File file -> entry.putString("Value", file.getPath());
          case com.google.gson.JsonObject jsObj -> entry.putString("Value", jsObj.toString());
          case com.google.gson.JsonArray jsArr -> entry.putString("Value", jsArr.toString());
          default -> entry.putString("Value", String.valueOf(${var.getName()}.get(i)));
        }
      
        ${var.getName()}_list.add(entry);
      }
      
      nbt.put("${var.getName()}", ${var.getName()}_list);
    get: ${JavaModName}Variables.WorldVariables.get(world).${name}
    set: |
      ${JavaModName}Variables.WorldVariables.get(world).${name}.addAll(${opt.removeParentheses(value)});
      ${JavaModName}Variables.WorldVariables.get(world).syncData(world);
  global_map:
    init: public ArrayList<Object> ${var.getName()} = ${var.getValue()};
    read: |
      ${var.getName()}.clear();
      
      ListTag ${var.getName()}_list = nbt.getListOrEmpty("${var.getName()}");
      for (Tag tag : ${var.getName()}_list) {
        CompoundTag entry = (CompoundTag) tag;
        String type = entry.getStringOr("Type", "");
      
        Object value = switch(type) {
          case "BlockState" -> NbtUtils.readBlockState(lookupProvider.lookupOrThrow(Registries.BLOCK), entry.getCompoundOrEmpty("Value"));
          case "Direction" -> Direction.from3DDataValue(entry.getIntOr("Value", 0));
          case "ItemStack" -> ItemStack.OPTIONAL_CODEC.parse(NbtOps.INSTANCE, nbt.getCompoundOrEmpty("Value")).result().orElse(ItemStack.EMPTY);
          case "Boolean" -> entry.getBooleanOr("Value", false);
          case "Double" -> entry.getDoubleOr("Value", 0.0d);
          case "String" -> entry.getStringOr("Value", "");
          case "Vec3" -> {
            ListTag vecList = entry.getListOrEmpty("Value");
            yield new Vec3(vecList.getDoubleOr(0, 0), vecList.getDoubleOr(1, 0), vecList.getDoubleOr(2, 0));
          }
          case "File" -> new File(entry.getStringOr("Value", ""));
          case "JsonObject" -> com.google.gson.JsonParser.parseString(entry.getStringOr("Value", "")).getAsJsonObject();
          case "JsonArray" -> com.google.gson.JsonParser.parseString(entry.getStringOr("Value", "")).getAsJsonArray();
          default -> entry.getStringOr("Value", "");
        };
      
        ${var.getName()}.add(value);
      }
    write: |
      ListTag ${var.getName()}_list = new ListTag();
      for(int i = 0; i < ${var.getName()}.size(); i++) {
        CompoundTag entry = new CompoundTag();
        entry.putString("Type", ${var.getName()}.get(i).getClass().getSimpleName());
      
        switch (${var.getName()}.get(i)) {
          case BlockState state -> entry.put("Value", NbtUtils.writeBlockState(state));
          case Direction direction -> entry.putInt("Value", direction.get3DDataValue());
          case ItemStack itemStack -> entry.put("Value", (CompoundTag) ItemStack.OPTIONAL_CODEC.encode(itemStack, NbtOps.INSTANCE, new CompoundTag()).result().orElse(new CompoundTag()));
          case Boolean bool -> entry.putBoolean("Value", bool);
          case Double doub -> entry.putDouble("Value", doub);
          case String str -> entry.putString("Value", str);
          case Vec3 vec -> {
            ListTag vecList = new ListTag();
            vecList.add(DoubleTag.valueOf(vec.x));
            vecList.add(DoubleTag.valueOf(vec.y));
            vecList.add(DoubleTag.valueOf(vec.z));
            entry.put("Value", vecList);
          }
          case File file -> entry.putString("Value", file.getPath());
          case com.google.gson.JsonObject jsObj -> entry.putString("Value", jsObj.toString());
          case com.google.gson.JsonArray jsArr -> entry.putString("Value", jsArr.toString());
          default -> entry.putString("Value", String.valueOf(${var.getName()}.get(i)));
        }
      
        ${var.getName()}_list.add(entry);
      }
      
      nbt.put("${var.getName()}", ${var.getName()}_list);
    get: ${JavaModName}Variables.MapVariables.get(world).${name}
    set: |
      ${JavaModName}Variables.MapVariables.get(world).${name}.addAll(${opt.removeParentheses(value)});
      ${JavaModName}Variables.MapVariables.get(world).syncData(world);